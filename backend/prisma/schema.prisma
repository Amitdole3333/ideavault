generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

//
// ENUMS (Type-safe, fixes Role error)
//

enum Role {
  FOUNDER
  INVESTOR
}

enum IdeaStage {
  IDEA
  MVP
  EARLY_TRACTION
  GROWTH
  SCALING
}

enum IdeaVisibility {
  PUBLIC
  PRIVATE
  NDA_REQUIRED
}

//
// MODELS
//

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  name          String
  role          Role     @default(FOUNDER)
  walletAddress String?  @unique
  bio           String?
  company       String?
  location      String?
  linkedinUrl   String?
  isVerified    Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  ideas            Idea[]
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  shortlists       Shortlist[]
}

model Idea {
  id           String         @id @default(uuid())
  title        String
  description  String
  category     String
  stage        IdeaStage
  location     String?
  fundingGoal  Float?
  teamSize     Int?
  pitchDeckUrl String?
  visibility   IdeaVisibility @default(PUBLIC)

  // Blockchain fields
  ideaHash       String  @unique
  txnId          String?
  appId          String?
  blockTimestamp Int?
  ipfsCid        String?
  isVerified     Boolean @default(false)

  founderId String
  founder   User   @relation(fields: [founderId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages   Message[]
  shortlists Shortlist[]
}

model Message {
  id         String   @id @default(uuid())
  content    String
  senderId   String
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId String
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  ideaId     String
  idea       Idea     @relation(fields: [ideaId], references: [id])
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
}

model Shortlist {
  id         String   @id @default(uuid())
  investorId String
  investor   User     @relation(fields: [investorId], references: [id])
  ideaId     String
  idea       Idea     @relation(fields: [ideaId], references: [id])
  note       String?
  createdAt  DateTime @default(now())

  @@unique([investorId, ideaId])
}